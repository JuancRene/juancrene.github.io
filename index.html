<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>BJJ Match Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@500;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #f8fafc;
            overflow: hidden; /* Prevent scrolling */
        }
        
        /* Prevent double-tap zoom on buttons */
        button {
            touch-action: manipulation;
        }

        .hidden { display: none !important; }
        
        /* Custom animations */
        @keyframes pulse-red {
            0%, 100% { color: #ef4444; }
            50% { color: #fca5a5; }
        }
        .animate-pulse-red { animation: pulse-red 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "lucide-react": "https://esm.sh/lucide-react@^0.563.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>

    <!-- ========================================== -->
    <!-- VIEW: SETUP SCREEN -->
    <!-- ========================================== -->
    <div id="setup-view" class="w-full h-screen overflow-y-auto bg-slate-900 p-6">
        <div class="max-w-md mx-auto space-y-8 pb-10">
            
            <div class="text-center space-y-2 pt-10">
                <h1 class="text-5xl font-black text-white tracking-tight">Vieyra Jiu Jitsu</h1>
                <p class="text-slate-400">Torneazo Interno</p>
            </div>

            <!-- Duration Selection -->
            <div class="space-y-4">
                <div class="flex items-center gap-2 text-emerald-400 mb-2">
                    <i data-lucide="timer" class="w-5 h-5"></i>
                    <span class="font-bold uppercase tracking-wider text-sm">Duración del Combate</span>
                </div>
                <div class="grid grid-cols-5 gap-2" id="duration-options">
                    <!-- Buttons generated by JS -->
                </div>
            </div>

            <!-- Competitor A Config -->
            <div class="space-y-6">
                <div>
                    <div class="flex items-center gap-2 text-emerald-400 mb-2">
                        <i data-lucide="user" class="w-5 h-5"></i>
                        <span class="font-bold uppercase tracking-wider text-sm">Competidor A</span>
                    </div>
                    <div class="space-y-3">
                        <input type="text" id="setup-name-a" value="Competidor A"
                            class="w-full bg-slate-800 border-2 border-slate-700 rounded-lg p-3 text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500 transition-all font-semibold" />
                        <div>
                            <div class="flex items-center gap-2 text-slate-400 mb-1">
                                <i data-lucide="shirt" class="w-4 h-4"></i>
                                <span class="text-xs font-bold uppercase tracking-wider">Color de Gi</span>
                            </div>
                            <div class="flex gap-2 mt-2" id="color-options-a">
                                <!-- Colors generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Competitor B Config -->
                <div>
                    <div class="flex items-center gap-2 text-emerald-400 mb-2">
                        <i data-lucide="user" class="w-5 h-5"></i>
                        <span class="font-bold uppercase tracking-wider text-sm">Competidor B</span>
                    </div>
                    <div class="space-y-3">
                        <input type="text" id="setup-name-b" value="Competidor B"
                            class="w-full bg-slate-800 border-2 border-slate-700 rounded-lg p-3 text-white placeholder-slate-500 focus:border-emerald-500 focus:outline-none focus:ring-1 focus:ring-emerald-500 transition-all font-semibold" />
                        <div>
                            <div class="flex items-center gap-2 text-slate-400 mb-1">
                                <i data-lucide="shirt" class="w-4 h-4"></i>
                                <span class="text-xs font-bold uppercase tracking-wider">Color de Gi</span>
                            </div>
                            <div class="flex gap-2 mt-2" id="color-options-b">
                                <!-- Colors generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pt-4">
                <button id="btn-start-match" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-4 px-8 rounded-lg text-xl uppercase tracking-widest shadow-lg shadow-emerald-900/50 transition-colors">
                    Comenzar Combate
                </button>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- VIEW: MATCH SCREEN -->
    <!-- ========================================== -->
    <div id="match-view" class="hidden flex flex-col h-screen bg-slate-900 overflow-hidden">
        
        <!-- Top Bar / Timer -->
        <div class="flex-none bg-slate-950 p-2 md:p-4 shadow-2xl z-50 relative border-b border-slate-800">
            <div class="max-w-full mx-auto flex items-center justify-between relative px-4">
                <!-- Exit -->
                <div class="flex items-center w-1/4 sm:w-1/3 z-50">
                    <button id="btn-exit" class="group flex items-center gap-2 px-3 py-2 -ml-2 rounded-lg hover:bg-slate-800 transition-all cursor-pointer">
                        <i data-lucide="chevron-left" class="w-8 h-8 text-slate-400 group-hover:text-white transition-colors"></i>
                        <span class="font-bold text-xl text-slate-300 group-hover:text-white hidden sm:inline">Salir</span>
                    </button>
                </div>
                
                <!-- Clock -->
                <div class="flex-1 flex justify-center z-40">
                    <div id="timer-display" class="font-mono text-[4.5rem] md:text-[7rem] lg:text-[9rem] font-black tracking-tighter tabular-nums transition-colors duration-300 drop-shadow-2xl leading-none text-white">
                        05:00
                    </div>
                </div>

                <!-- Status -->
                <div class="w-1/4 sm:w-1/3 flex justify-end items-center z-40">
                    <span id="status-finished" class="hidden text-sm md:text-xl font-black bg-red-600 text-white px-4 py-2 rounded animate-bounce shadow-lg shadow-red-900/50">FINAL</span>
                </div>
            </div>
        </div>

        <!-- Main Content: Competitors -->
        <div class="flex-1 flex flex-col md:flex-row overflow-hidden relative z-10">
            <!-- Divider -->
            <div class="absolute left-1/2 top-0 bottom-0 w-1 bg-black hidden md:block z-20 shadow-[0_0_10px_rgba(0,0,0,0.8)]"></div>

            <!-- Competitor A Panel -->
            <div id="panel-a" class="flex-1 relative border-b-4 md:border-b-0 md:border-r-0 border-black flex flex-col h-full transition-colors duration-300 overflow-hidden relative">
                <!-- Content injected by JS render -->
            </div>
            
            <!-- Competitor B Panel -->
            <div id="panel-b" class="flex-1 relative flex flex-col h-full transition-colors duration-300 overflow-hidden relative">
                <!-- Content injected by JS render -->
            </div>
        </div>

        <!-- Bottom Controls -->
        <div class="flex-none bg-slate-950 p-2 border-t border-slate-800 z-50 relative shadow-[0_-5px_20px_rgba(0,0,0,0.5)]">
            <div class="max-w-xl mx-auto flex items-center justify-center gap-4">
                
                <button id="btn-reset-timer" title="Reiniciar Tiempo" class="bg-slate-700 hover:bg-slate-600 text-white p-3 rounded-lg shadow-lg transition-colors">
                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                </button>

                <button id="btn-toggle-timer" class="flex-1 max-w-xs py-3 text-lg font-bold uppercase tracking-widest rounded-lg transition-all flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white ring-2 ring-emerald-500/50 shadow-[0_0_15px_rgba(16,185,129,0.4)]">
                    <i data-lucide="play" class="w-6 h-6 fill-current"></i>
                    <span id="btn-toggle-text">INICIAR</span>
                </button>

                <button id="btn-settings" title="Configuración" class="hover:bg-slate-800 text-slate-300 p-3 rounded-lg transition-colors">
                    <i data-lucide="settings" class="w-6 h-6"></i>
                </button>

            </div>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- CONSTANTS & CONFIG ---
        const DURATION_OPTIONS = [5, 6, 7, 8, 10];
        const COLORS = {
            WHITE: 'Blanco',
            BLUE: 'Azul',
            BLACK: 'Negro'
        };
        
        // Themes definition matching the React version
        const THEMES = {
            [COLORS.WHITE]: {
                bg: 'bg-slate-100',
                text: 'text-slate-900',
                border: 'border-slate-300',
                // advColor/warnColor replaced by solid backgrounds
                subBtn: 'bg-slate-200 text-slate-500 hover:bg-slate-300',
                addBtn: 'bg-slate-300 text-slate-900 hover:bg-slate-400',
                scoreBtn: 'bg-white border-2 border-slate-300 text-slate-900 hover:bg-slate-50 active:bg-slate-200'
            },
            [COLORS.BLUE]: {
                bg: 'bg-blue-800',
                text: 'text-white',
                border: 'border-blue-600',
                // advColor/warnColor replaced by solid backgrounds
                subBtn: 'bg-blue-900/50 text-blue-300 hover:bg-blue-900',
                addBtn: 'bg-blue-700 text-white hover:bg-blue-600',
                scoreBtn: 'bg-blue-700 border-2 border-blue-600 text-white hover:bg-blue-600 active:bg-blue-500'
            },
            [COLORS.BLACK]: {
                bg: 'bg-neutral-900',
                text: 'text-white',
                border: 'border-neutral-800',
                // advColor/warnColor replaced by solid backgrounds
                subBtn: 'bg-neutral-800 text-neutral-500 hover:bg-neutral-700',
                addBtn: 'bg-neutral-800 text-white hover:bg-neutral-700',
                scoreBtn: 'bg-neutral-800 border-2 border-neutral-700 text-white hover:bg-neutral-700 active:bg-neutral-600'
            }
        };

        // --- STATE ---
        let state = {
            status: 'SETUP', // SETUP, ACTIVE, PAUSED, FINISHED
            duration: 5,
            timeLeft: 300,
            intervalId: null,
            competitors: {
                A: { name: 'Competidor A', color: COLORS.WHITE, points: 0, advantages: 0, warnings: 0 },
                B: { name: 'Competidor B', color: COLORS.BLUE, points: 0, advantages: 0, warnings: 0 }
            }
        };

        // --- DOM ELEMENTS ---
        const views = {
            setup: document.getElementById('setup-view'),
            match: document.getElementById('match-view')
        };

        // --- INITIALIZATION ---
        function init() {
            renderSetupDuration();
            renderSetupColors('A');
            renderSetupColors('B');
            lucide.createIcons();
            
            // Event Listeners for Setup Inputs
            document.getElementById('setup-name-a').addEventListener('input', (e) => state.competitors.A.name = e.target.value);
            document.getElementById('setup-name-b').addEventListener('input', (e) => state.competitors.B.name = e.target.value);
            
            // Buttons
            document.getElementById('btn-start-match').addEventListener('click', startMatch);
            document.getElementById('btn-exit').addEventListener('click', exitMatch);
            document.getElementById('btn-settings').addEventListener('click', exitMatch); // Settings behaves like exit to setup
            document.getElementById('btn-toggle-timer').addEventListener('click', toggleTimer);
            document.getElementById('btn-reset-timer').addEventListener('click', resetTimer);
        }

        // --- RENDER FUNCTIONS: SETUP ---
        function renderSetupDuration() {
            const container = document.getElementById('duration-options');
            container.innerHTML = '';
            DURATION_OPTIONS.forEach(mins => {
                const btn = document.createElement('button');
                const isActive = state.duration === mins;
                btn.className = `aspect-square rounded-lg font-bold text-lg border-2 flex flex-col items-center justify-center transition-all ${
                    isActive 
                    ? 'bg-emerald-600 border-emerald-400 text-white shadow-[0_0_15px_rgba(16,185,129,0.3)]' 
                    : 'bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700'
                }`;
                btn.innerHTML = `<span>${mins}</span><span class="text-xs font-normal opacity-75">min</span>`;
                btn.onclick = () => {
                    state.duration = mins;
                    renderSetupDuration();
                };
                container.appendChild(btn);
            });
        }

        function renderSetupColors(compId) {
            const container = document.getElementById(`color-options-${compId.toLowerCase()}`);
            container.innerHTML = '';
            Object.values(COLORS).forEach(color => {
                const isActive = state.competitors[compId].color === color;
                const btn = document.createElement('button');
                
                let colorClasses = '';
                if(color === COLORS.WHITE) colorClasses = 'bg-white text-black border-slate-300';
                if(color === COLORS.BLUE) colorClasses = 'bg-blue-700 text-white border-blue-900';
                if(color === COLORS.BLACK) colorClasses = 'bg-neutral-900 text-white border-neutral-700';

                btn.className = `flex-1 py-3 px-2 rounded-md border-2 font-semibold text-sm transition-all ${colorClasses} ${
                    isActive ? 'ring-4 ring-emerald-500 scale-105 shadow-lg' : 'opacity-60 hover:opacity-100'
                }`;
                btn.textContent = color;
                btn.onclick = () => {
                    state.competitors[compId].color = color;
                    renderSetupColors(compId);
                };
                container.appendChild(btn);
            });
        }

        // --- LOGIC: MATCH ---
        function startMatch() {
            state.status = 'PAUSED'; // Start paused, ready to play
            state.timeLeft = state.duration * 60;
            
            // Switch views
            views.setup.classList.add('hidden');
            views.match.classList.remove('hidden');
            
            renderTimer();
            buildCompetitorPanel('A');
            buildCompetitorPanel('B');
            updatePlayButton();
            
            // Force Icon reload for the new elements
            lucide.createIcons();
        }

        function exitMatch() {
            stopTimer();
            state.status = 'SETUP';
            state.competitors.A.points = 0;
            state.competitors.A.advantages = 0;
            state.competitors.A.warnings = 0;
            state.competitors.B.points = 0;
            state.competitors.B.advantages = 0;
            state.competitors.B.warnings = 0;
            
            views.match.classList.add('hidden');
            views.setup.classList.remove('hidden');
        }

        function buildCompetitorPanel(compId) {
            const comp = state.competitors[compId];
            const theme = THEMES[comp.color];
            const panel = document.getElementById(`panel-${compId.toLowerCase()}`);
            
            // Apply theme classes to parent
            panel.className = `flex-1 relative flex flex-col h-full transition-colors duration-300 overflow-hidden relative ${theme.bg} ${theme.text}`;
            if(compId === 'A') panel.classList.add('md:border-r-0', 'border-black');

            panel.innerHTML = `
                <!-- Header Name -->
                <div class="flex-none p-4 text-center border-b ${theme.border} relative z-10">
                    <h2 class="text-3xl md:text-5xl font-black uppercase tracking-tight truncate leading-tight drop-shadow-sm">${comp.name}</h2>
                </div>

                <!-- Main Points -->
                <div class="flex-1 flex flex-col items-center justify-center relative min-h-0">
                    <span id="score-${compId}" class="text-[12rem] md:text-[16rem] lg:text-[20rem] font-black leading-none tracking-tighter drop-shadow-lg select-none">
                        ${comp.points}
                    </span>
                    <span class="absolute top-4 font-bold tracking-[0.3em] opacity-60 text-lg uppercase">Puntos</span>
                </div>

                <!-- Stats Row - COLORED BACKGROUNDS -->
                <div class="flex-none grid grid-cols-2 divide-x ${theme.border} border-t ${theme.border}">
                    <!-- Advantages: Green Background -->
                    <div class="flex flex-col items-center justify-center p-2 pb-4 relative group bg-emerald-600 text-white">
                        <span class="text-xs font-bold uppercase tracking-widest opacity-80 mb-1">Ventajas</span>
                        <div class="flex items-center gap-4">
                            <button onclick="updateScore('${compId}', 'advantages', -1)" class="p-2 rounded opacity-0 group-hover:opacity-100 transition-all bg-black/20 hover:bg-black/30 text-white"><i data-lucide="minus" class="w-5 h-5"></i></button>
                            <span id="adv-${compId}" class="text-6xl md:text-7xl font-black font-mono leading-none drop-shadow-sm">${comp.advantages}</span>
                            <button onclick="updateScore('${compId}', 'advantages', 1)" class="p-2 rounded opacity-0 group-hover:opacity-100 transition-all bg-black/20 hover:bg-black/30 text-white"><i data-lucide="plus" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                    <!-- Warnings: Red Background -->
                    <div class="flex flex-col items-center justify-center p-2 pb-4 relative group bg-red-600 text-white">
                        <span class="text-xs font-bold uppercase tracking-widest opacity-80 mb-1">Penalización</span>
                        <div class="flex items-center gap-4">
                            <button onclick="updateScore('${compId}', 'warnings', -1)" class="p-2 rounded opacity-0 group-hover:opacity-100 transition-all bg-black/20 hover:bg-black/30 text-white"><i data-lucide="minus" class="w-5 h-5"></i></button>
                            <span id="warn-${compId}" class="text-6xl md:text-7xl font-black font-mono leading-none drop-shadow-sm">${comp.warnings}</span>
                            <button onclick="updateScore('${compId}', 'warnings', 1)" class="p-2 rounded opacity-0 group-hover:opacity-100 transition-all bg-black/20 hover:bg-black/30 text-white"><i data-lucide="plus" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Scoring Controls -->
                <div class="flex-none p-3 grid grid-cols-3 gap-3 bg-black/5">
                    ${[2,3,4].map(pts => `
                        <div class="relative group">
                            <button onclick="updateScore('${compId}', 'points', ${pts})" class="w-full py-4 rounded-xl flex flex-col items-center justify-center transition-transform active:scale-95 shadow-sm ${theme.scoreBtn}">
                                <span class="text-3xl font-black leading-none mb-1">+${pts}</span>
                            </button>
                            <button onclick="event.stopPropagation(); updateScore('${compId}', 'points', -${pts})" class="absolute -top-3 -right-2 w-8 h-8 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-red-600 text-white shadow-lg z-20 hover:bg-red-700">
                                <i data-lucide="minus" class="w-4 h-4" stroke-width="4"></i>
                            </button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Exposed globally for HTML onclick attributes
        window.updateScore = function(compId, field, amount) {
            const currentVal = state.competitors[compId][field];
            let newVal = currentVal + amount;
            if (newVal < 0) newVal = 0; // Prevent negatives
            
            state.competitors[compId][field] = newVal;
            
            // DOM Update
            if (field === 'points') document.getElementById(`score-${compId}`).textContent = newVal;
            if (field === 'advantages') document.getElementById(`adv-${compId}`).textContent = newVal;
            if (field === 'warnings') document.getElementById(`warn-${compId}`).textContent = newVal;
        };

        // --- TIMER LOGIC ---
        function toggleTimer() {
            if (state.status === 'FINISHED') return;
            
            if (state.status === 'ACTIVE') {
                pauseTimer();
            } else {
                startTimer();
            }
            updatePlayButton();
        }

        function startTimer() {
            state.status = 'ACTIVE';
            state.intervalId = setInterval(() => {
                if (state.timeLeft > 0) {
                    state.timeLeft--;
                    renderTimer();
                } else {
                    finishMatch();
                }
            }, 1000);
        }

        function pauseTimer() {
            state.status = 'PAUSED';
            clearInterval(state.intervalId);
        }

        function stopTimer() {
            clearInterval(state.intervalId);
            state.intervalId = null;
        }

        function resetTimer() {
            pauseTimer();
            state.timeLeft = state.duration * 60;
            state.status = 'PAUSED';
            document.getElementById('status-finished').classList.add('hidden');
            document.getElementById('timer-display').classList.remove('text-red-500', 'animate-pulse');
            document.getElementById('timer-display').classList.add('text-white');
            renderTimer();
            updatePlayButton();
        }

        function finishMatch() {
            stopTimer();
            state.status = 'FINISHED';
            document.getElementById('status-finished').classList.remove('hidden');
            document.getElementById('timer-display').classList.remove('text-white', 'text-yellow-400');
            document.getElementById('timer-display').classList.add('text-red-500', 'animate-pulse');
            updatePlayButton();
        }

        function renderTimer() {
            const m = Math.floor(state.timeLeft / 60);
            const s = state.timeLeft % 60;
            const text = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
            const display = document.getElementById('timer-display');
            display.textContent = text;

            // Warning color
            if (state.timeLeft < 60 && state.status === 'ACTIVE') {
                 display.classList.remove('text-white');
                 display.classList.add('text-yellow-400');
            } else if (state.timeLeft >= 60 && state.status !== 'FINISHED') {
                 display.classList.add('text-white');
                 display.classList.remove('text-yellow-400');
            }
        }

        function updatePlayButton() {
            const btn = document.getElementById('btn-toggle-timer');
            const text = document.getElementById('btn-toggle-text');
            const icon = btn.querySelector('svg'); // Lucide replaces <i> with <svg>

            btn.className = "flex-1 max-w-xs py-3 text-lg font-bold uppercase tracking-widest rounded-lg transition-all flex items-center justify-center gap-2 ";

            if (state.status === 'ACTIVE') {
                btn.classList.add('bg-slate-700', 'hover:bg-slate-600', 'text-white', 'ring-2', 'ring-red-500/50');
                // Updated text to 'PAUSAR'
                btn.innerHTML = `<i data-lucide="pause" class="w-6 h-6 fill-current"></i><span>PAUSAR</span>`;
            } else {
                btn.classList.add('bg-emerald-600', 'hover:bg-emerald-700', 'text-white', 'ring-2', 'ring-emerald-500/50', 'shadow-[0_0_15px_rgba(16,185,129,0.4)]');
                const label = state.timeLeft < (state.duration * 60) ? "REANUDAR" : "INICIAR";
                btn.innerHTML = `<i data-lucide="play" class="w-6 h-6 fill-current"></i><span>${label}</span>`;
            }
            lucide.createIcons();
        }

        // Start App
        init();

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>